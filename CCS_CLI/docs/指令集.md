# CCS CLI 指令集 (Instruction Set)

这是一份关于 **CharacterCard Studio CLI (`ccs-cli`)** 的完整指令手册。
本项目采用 **CLI (命令行工具)** + **MCP (模型上下文协议)** 的双模式架构。

## 1. CLI 命令行工具 (`st`)

CLI 模式用于人类用户或 Agent 执行具体的“写操作”和项目管理任务。

**通用用法**: `st <command> [options]`

| 命令 | 用途 | 常见示例 | 最佳实践 |
| :--- | :--- | :--- | :--- |
| **`init`** | 初始化新项目 | `st init "My Project"` | 适合从零开始创建一个新的世界书或角色卡项目。 |
| **`clone`** | 克隆现有资源 | `st clone "xxx"` | **推荐**。最常用的起手式，将 SillyTavern 中的资源拉取到本地进行编辑。支持世界书和角色卡。 |
| **`pull`** | 拉取/更新资源 | `st pull` | 当 SillyTavern 有改动（如在网页端编辑过）时，用此命令同步回本地文件。 |
| **`push`** | 推送更改 | `st push` | 编辑完本地 YAML/Markdown 文件后，用此命令将更改同步回 SillyTavern。 |
| **`watch`** | 监听并自动推送 | `st watch` | **开发首选**。启动后，你每次保存文件，它都会自动推送到 SillyTavern。支持热重载。 |
| **`mcp`** | 启动 MCP 服务 | `st mcp --sse` | 启动后端服务，让 Cursor/Claude 能够“看到”和“操作”SillyTavern 数据。 |

### 详细说明

#### `st clone`
从 SillyTavern 克隆现有的世界书或角色。
*   **参数**: `<name>` (资源名称)
*   **选项**:
    *   `--type <worldbook|character>`: 指定类型（默认为 worldbook）
*   **示例**:
    ```bash
    st clone "Cyberpunk 2077" --type worldbook
    st clone "Alice" --type character
    ```

#### `st mcp`
启动 MCP 服务器。
*   **选项**:
    *   `--sse`: 启用 SSE (Server-Sent Events) 模式（推荐）。
    *   `--port <number>`: 指定端口（默认 3000）。
*   **交互模式**: 启动后进入 REPL 界面，可输入 `help`, `status`, `current` 等指令。

---

## 2. MCP 工具集 (Agent Tools)

MCP 模式赋予 AI Agent (如 Cursor/Claude) "感知" 和 "操作" 的能力。这些工具由 Agent 在对话中自动调用。

| 工具名称 | 用途 | 输入参数 | 返回内容 |
| :--- | :--- | :--- | :--- |
| **`search_worldinfo`** | 搜索世界书条目 | `query` (关键词), `book` (可选书名) | 匹配的条目列表（含 ID、Key、内容片段）。支持搜书名和内容。 |
| **`get_worldbook_details`** | 获取世界书详情 | `book` (书名) | 该书所有条目的完整列表摘要。 |
| **`search_characters`** | 搜索角色 | `query` (名称或 Tag) | 匹配的角色列表。 |
| **`get_character_details`** | 获取角色详情 | `name` (角色名) | 角色的完整 JSON 元数据。 |
| **`get_current_chat`** | 获取当前聊天上下文 | `limit` (消息数量) | **核心功能**。获取 SillyTavern 当前激活角色的聊天记录，转换为剧本格式。 |
| **`get_project_tree`** | 获取项目结构 | (无) | 当前目录的文件树结构。 |

### 场景示例

#### 场景 1：写设定
*   **用户**: "把这个角色的背景故事完善一下。"
*   **Agent**:
    1.  调用 `get_current_chat` 理解当前剧情进展。
    2.  调用 `search_worldinfo` 查询相关背景设定（以免吃书）。
    3.  调用 `edit_file` (IDE 原生) 修改本地文档。
    4.  用户/Agent 运行 `st push` 同步。

#### 场景 2：查资料
*   **用户**: "那个叫‘暗影议会’的组织是干嘛的？"
*   **Agent**:
    1.  调用 `search_worldinfo(query="暗影议会")`。
    2.  返回条目内容给用户。

---

## 3. 最佳工作流 (Best Practices)

1.  **启动阶段**:
    *   在一个终端运行 `st mcp --sse`，保持后台常驻。
    *   这让 AI 随时能获取 SillyTavern 的上下文。

2.  **开发阶段**:
    *   在另一个终端运行 `st watch`。
    *   这让你/AI 的每一次文件保存都能实时生效。

3.  **混合操作**:
    *   既可以使用 CLI (`st clone`) 手动管理。
    *   也可以让 AI 在 SSE 终端中执行指令（通过 `execute_command` 工具，规划中）。

---

> **Note**: 本文档随项目更新。
> 生成时间: 2026-01-31

